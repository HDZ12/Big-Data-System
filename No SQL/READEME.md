# 1.简介
通常，NoSQL数据库具有以下几个特点：\
（1）灵活的可扩展性\
（2）灵活的数据模型\
（3）与云计算紧密融合\
No SQL与关系型数据库的比较\
![1701679999677](https://github.com/HDZ12/Big-Data-System/assets/99587726/ea2726a6-9866-4cd9-8ecb-db19f7e3f304)
![1701680063084](https://github.com/HDZ12/Big-Data-System/assets/99587726/07d24488-3c7f-40e8-a4f9-de0a4e585348)
![1701680138427](https://github.com/HDZ12/Big-Data-System/assets/99587726/f0391598-99d2-4f30-ae02-edcf0884d1c1)
## 总结
（1）关系数据库\
优势：以完善的关系代数理论作为基础，有严格的标准，支持事务ACID四性，借助索引机制可以实现高效的查询，技术成熟，有专业公司的技术支持
劣势：可扩展性较差，无法较好支持海量数据存储，数据模型过于死板、无法较好支持Web2.0应用，事务机制影响了系统的整体性能等\
（2）NoSQL数据库\
优势：可以支持超大规模数据存储，灵活的数据模型可以很好地支持Web2.0应用，具有强大的横向扩展能力等\
劣势：缺乏数学理论基础，复杂查询性能不高，大都不能实现事务强一致性，很难实现数据完整性，技术尚不成熟，缺乏专业团队的技术支持，维护较困难等\
关系数据库和NoSQL数据库各有优缺点，彼此无法取代\
关系数据库应用场景：电信、银行等领域的关键业务系统，需要保证强事务一致性\
NoSQL数据库应用场景：互联网企业、传统企业的非关键业务（比如数据分析）

采用混合架构\
案例：亚马逊公司就使用不同类型的数据库来支撑它的电子商务应用\
对于“购物篮”这种临时性数据，采用键值存储会更加高效\
当前的产品和订单信息则适合存放在关系数据库中\
大量的历史订单信息则适合保存在类似MongoDB的文档数据库中
# 2.No SQL的四大类型 
NoSQL数据库虽然数量众多，但是，归结起来，典型的NoSQL数据库通常包括键值数据库、列族数据库、文档数据库和图形数据库
![1701680325635](https://github.com/HDZ12/Big-Data-System/assets/99587726/43d84a16-2478-41aa-9318-efbbd0cf22f7)
![1701680339572](https://github.com/HDZ12/Big-Data-System/assets/99587726/dec3305d-73d0-4ca9-b8b8-79450c9e3706)
## 2.1键值数据库
![1701680644146](https://github.com/HDZ12/Big-Data-System/assets/99587726/8c066723-61f6-432c-a651-a1ed2df1cccb)\
Redis有时候会被人们称为“强化版的Memcached”
支持持久化、数据恢复、更多数据类型
## 2.2列族数据库
![1701680808114](https://github.com/HDZ12/Big-Data-System/assets/99587726/d4fe2f92-dc14-4033-b7dd-08187d9426a9)
## 2.3文档数据库
“文档”其实是一个数据记录，这个记录能够对包含的数据类型和内容进行“自我描述”。XML文档、HTML文档和JSON 文档就属于这一类。SequoiaDB就是使用JSON格式的文档数据库，它的存储的数据是这样的：
![Pasted image 20231204170814](https://github.com/HDZ12/Big-Data-System/assets/99587726/89a96d7e-68b3-4080-8cdf-2b609ffa08d5)
关系数据库：\
必须有schema信息才能理解数据的含义\
学生（学号，姓名，性别，年龄，系，年级）\
（1001，张三，男，20，计算机，2002）\
数据是不规则的，每一条记录包含了所有的有关“SequoiaDB”的信息而没有任何外部的引用，这条记录就是“自包含”的\
这使得记录很容易完全移动到其他服务器，因为这条记录的所有信息都包含在里面了，不需要考虑还有信息在别的表没有一起迁移走\
同时，因为在移动过程中，只有被移动的那一条记录（文档）需要操作，而不像关系型中每个有关联的表都需要锁住来保证一致性，这样一来ACID的保证就会变得更快速，读写的速度也会有很大的提升\
![1701680981099](https://github.com/HDZ12/Big-Data-System/assets/99587726/41dda01c-12e5-4ed3-a166-37a98e01a4c9)
## 2.4图形数据库
![1701681024586](https://github.com/HDZ12/Big-Data-System/assets/99587726/5d25f83b-dfaa-434c-be4b-c2f34754c6ba)
# 3.不同类型数据库比较
- MySQL产生年代较早，而且随着LAMP大潮得以成熟。尽管其没有什么大的改进，但是新兴的互联网使用的最多的数据库
- MongoDB是个新生事物，提供更灵活的数据模型、异步提交、地理位置索引等五花十色的功能
- HBase是个“仗势欺人”的大象兵。依仗着Hadoop的生态环境，可以有很好的扩展性。但是就像象兵一样，使用者需要养一头大象(Hadoop),才能驱使他
- Redis是键值存储的代表，功能最简单。提供随机数据存储。就像一根棒子一样，没有多余的构造。但是也正是因此，它的伸缩性特别好。就像悟空手里的金箍棒，大可捅破天，小能成缩成
# **4.No SQL 三大基石**
![1701681183993](https://github.com/HDZ12/Big-Data-System/assets/99587726/fc083d8d-eaaf-4097-af21-f3a160c2fdd0)
## **CAP**
- **C（Consistency）**：一致性，是指任何一个读操作总是能够读到之前完成的写操作的结果，也就是在分布式环境中，多点的数据是一致的，或者说，所有节点在同一时间具有相同的数据。
- **A:（Availability）**：可用性，是指快速获取数据，可以在确定的时间内返回操作结果，保证每个请求不管成功或者失败都有响应；
- **P（Tolerance of Network Partition）**：分区容忍性，是指当出现网络分区的情况时（即系统中的一部分节点无法和其他节点进行通信），分离的系统也能够正常运行，也就是说，系统中任意信息的丢失或失败不会影响系统的继续运作。
- CAP理论告诉我们，一个分布式系统不可能同时满足一致性、可用性和分区容忍性这三个需求，最多只能同时满足其中两个，正所谓“鱼和熊掌不可兼得”。\
![Pasted image 20231204171608](https://github.com/HDZ12/Big-Data-System/assets/99587726/c58864bc-2a6b-4b51-857a-48d644d31888)\
当处理CAP的问题时，可以有几个明显的选择：
1. CA：也就是强调一致性（C）和可用性（A），放弃分区容忍性（P），最简单的做法是把所有与事务相关的内容都放到同一台机器上。很显然，这种做法会严重影响系统的可扩展性。传统的关系数据库（MySQL、SQL Server和PostgreSQL），都采用了这种设计原则，因此，扩展性都比较差
2. CP：也就是强调一致性（C）和分区容忍性（P），放弃可用性（A），当出现网络分区的情况时，受影响的服务需要等待数据一致，因此在等待期间就无法对外提供服务
3. AP：也就是强调可用性（A）和分区容忍性（P），放弃一致性（C），允许系统返回不一致的数据\
![1701685476054](https://github.com/HDZ12/Big-Data-System/assets/99587726/88ccd81b-25c3-41a1-89f1-08a22e0b80c3)
## **BASE**
说起BASE（Basically Availble, Soft-state, Eventual consistency），不得不谈到ACID。\
![1701685549463](https://github.com/HDZ12/Big-Data-System/assets/99587726/0082a40c-2490-4974-959c-9c2435b3e7b5)\
一个数据库事务具有ACID四性：
- A（Atomicity）：原子性，是指事务必须是原子工作单元，对于其数据修改，要么全都执行，要么全都不执行
- C（Consistency）：一致性，是指事务在完成时，必须使所有的数据都保持一致状态
- I（Isolation）：隔离性，是指由并发事务所做的修改必须与任何其它并发事务所做的修改隔离
- D（Durability）：持久性，是指事务完成之后，它对于系统的影响是永久性的，该修改即使出现致命的系统故障也将一直保持
BASE的基本含义是基本可用（Basically Availble）、软状态（Soft-state）和最终一致性（Eventual consistency）：
- 基本可用
       基本可用，是指一个分布式系统的一部分发生问题变得不可用时，其他部分仍然可以正常使用，也就是允许分区失败的情形出现
- 软状态
        “软状态（soft-state）”是与“硬状态（hard-state）”相对应的一种提法。数据库保存的数据是“硬状态”时，可以保证数据一致性，即保证数据一直是正确的。“软状态”是指状态可以有一段时间不同步，具有一定的滞后性
- 最终一致性
       一致性的类型包括强一致性和弱一致性，二者的主要区别在于高并发的数据访问操作下，后续操作是否能够获取最新的数据。对于强一致性而言，当执行完一次更新操作后，后续的其他读操作就可以保证读到更新后的最新数据；反之，如果不能保证后续访问读到的都是更新后的最新数据，那么就是弱一致性。而最终一致性只不过是弱一致性的一种特例，允许后续的访问操作可以暂时读不到更新后的数据，但是经过一段时间之后，必须最终读到更新后的数据。最常见的实现最终一致性的系统是DNS（域名系统）。一个域名更新操作根据配置的形式被分发出去，并结合有过期机制的缓存；最终所有的客户端可以看到最新的值。
最终一致性根据更新数据后各进程访问到数据的时间和方式的不同，又可以区分为：
- 因果一致性：如果进程A通知进程B它已更新了一个数据项，那么进程B的后续访问将获得A写入的最新值。而与进程A无因果关系的进程C的访问，仍然遵守一般的最终一致性规则
- “读己之所写”一致性：可以视为因果一致性的一个特例。当进程A自己执行一个更新操作之后，它自己总是可以访问到更新过的值，绝不会看到旧值
- 单调读一致性：如果进程已经看到过数据对象的某个值，那么任何后续访问都不会返回在那个值之前的值
- 会话一致性：它把访问存储系统的进程放到会话（session）的上下文中，只要会话还存在，系统就保证“读己之所写”一致性。如果由于某些失败情形令会话终止，就要建立新的会话，而且系统保证不会延续到新的会话
- 单调写一致性：系统保证来自同一个进程的写操作顺序执行。系统必须保证这种程度的一致性，否则就非常难以编程了
如何实现各种类型的一致性？\
对于分布式数据系统：\
N — 数据复制的份数\
W — 更新数据时需要保证写完成的节点数\
R — 读取数据的时候需要读取的节点数\
如果W+R>N，写的节点和读的节点重叠，则是强一致性。例如对于典型的一主一备同步复制的关系型数据库，N=2,W=2,R=1，则不管读的是主库还是备库的数据，都是一致的。一般设定是R＋W = N+1，这是保证强一致性的最小设定\
如果W+R<=N，则是弱一致性。例如对于一主一备异步复制的关系型数据库，N=2,W=1,R=1，则如果读的是备库，就可能无法读取主库已经更新过的数据，所以是弱一致性。对于分布式系统，为了保证高可用性，一般设置N>=3。不同的N,W,R组合，是在可用性和一致性之间取一个平衡，以适应不同的应用场景。\
如果N=W,R=1，任何一个写节点失效，都会导致写失败，因此可用性会降低，但是由于数据分布的N个节点是同步写入的，因此可以保证强一致性。\
实例：HBase是借助其底层的HDFS来实现其数据冗余备份的。HDFS采用的就是强一致性保证。在数据没有完全同步到N个节点前，写操作是不会返回成功的。也就是说它的W＝N，而读操作只需要读到一个值即可，也就是说它R＝1。\
像Voldemort，Cassandra和Riak这些类Dynamo的系统，通常都允许用户按需要设置N，R，W三个值，即使是设置成W＋R<= N也是可以的。也就是说他允许用户在强一致性和最终一致性之间自由选择。而在用户选择了最终一致性，或者是W<N的强一致性时，则总会出现一段“各个节点数据不同步导致系统处理不一致的时间”。为了提供最终一致性的支持，这些系统会提供一些工具来使数据更新被最终同步到所有相关节点。
# **文档数据库**
# mongoDB简介
- MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。
- 在高负载的情况下，添加更多的节点，可以保证服务器性能。
- MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。
- MongoDB 将数据存储为一个文档，数据结构由键值(key=>value)对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。
# 主要特点
- 提供了一个面向文档存储，操作起来比较简单和容易
- 可以设置任何属性的索引来实现更快的排序
- 具有较好的水平可扩展性
- 支持丰富的查询表达式，可轻易查询文档中内嵌的对象及数组
- 可以实现替换完成的文档（数据）或者一些指定的数据字段
- MongoDB中的Map/Reduce主要是用来对数据进行批量处理和聚合操作
- 支持各种编程语言:RUBY，PYTHON，JAVA，C++，PHP，C#等语言
- MongoDB安装简单
## mongo概念解析
在mongodb中基本的概念是文档、集合、数据库\
![1701768345311](https://github.com/HDZ12/Big-Data-System/assets/99587726/17cb8fd4-6ca2-4362-9777-d02b24c33975)
- 数据库：
	- 一个mongodb中可以建立多个数据库。MongoDB的默认数据库为"db"，该数据库存储在data目录中。MongoDB的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中。
- 文档：
	- 文档是一个键值(key-value)对(即BSON)。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。
- 集合：
	- 合就是 MongoDB 文档组，类似于 RDBMS （关系数据库管理系统：Relational Database Management System)中的表格。集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据，但通常情况下我们插入集合的数据都会有一定的关联性。
## MongoDB数据类型
![1701768625263](https://github.com/HDZ12/Big-Data-System/assets/99587726/4f3834e8-7831-4fb9-b20f-001a073cee31)
